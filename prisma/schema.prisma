generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int            @id @default(autoincrement())
  email           String         @unique
  username        String         @unique
  password        String
  fullName        String?
  bio             String?        @db.Text
  profilePicture  String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  books           UserBook[]
  ratings         Rating[]
  comments        Comment[]
  posts           Post[]
  postLikes       PostLike[]
  postComments    PostComment[]
  followers       Follow[]       @relation("UserFollowers")
  following       Follow[]       @relation("UserFollowing")
  @@map("users")
}

model Book {
  id              Int            @id @default(autoincrement())
  googleId        String         @unique
  title           String
  authors         String
  description     String?        @db.Text
  thumbnail       String?
  publishedDate   String?
  pageCount       Int?
  categories      String          
  language        String?
  averageRating   Float          @default(0)
  ratingCount     Int            @default(0)
  pdfUrl          String?        // Stores the filename in the GitHub repo
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  userBooks       UserBook[]
  ratings         Rating[]
  comments        Comment[]
  @@map("books")
}

model UserBook {
  id              Int            @id @default(autoincrement())
  userId          Int
  bookId          Int
  status          String  @default("READING")
  currentPage     Int?
  startedAt       DateTime?
  finishedAt      DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  book            Book           @relation(fields: [bookId], references: [id], onDelete: Cascade)
  @@unique([userId, bookId])
  @@map("user_books")
}

model Rating {
  id              Int            @id @default(autoincrement())
  userId          Int
  bookId          Int
  rating          Int
  review          String?        @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  book            Book           @relation(fields: [bookId], references: [id], onDelete: Cascade)
  @@unique([userId, bookId])
  @@map("ratings")
}

model Comment {
  id              Int            @id @default(autoincrement())
  userId          Int
  bookId          Int
  content         String         @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  book            Book           @relation(fields: [bookId], references: [id], onDelete: Cascade)
  @@map("comments")
}

model Post {
  id              Int            @id @default(autoincrement())
  userId          Int
  content         String         @db.Text
  image           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes           PostLike[]
  comments        PostComment[]
  @@map("posts")
}

model PostLike {
  id              Int            @id @default(autoincrement())
  userId          Int
  postId          Int
  createdAt       DateTime       @default(now())
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  post            Post           @relation(fields: [postId], references: [id], onDelete: Cascade)
  @@unique([userId, postId])
  @@map("post_likes")
}

model Follow {
  id              Int            @id @default(autoincrement())
  followerId      Int
  followingId     Int
  createdAt       DateTime       @default(now())
  follower        User           @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following       User           @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)
  @@unique([followerId, followingId])
  @@map("follows")
}

model PostComment {
  id              Int            @id @default(autoincrement())
  userId          Int
  postId          Int
  content         String         @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  post            Post           @relation(fields: [postId], references: [id], onDelete: Cascade)
  @@map("post_comments")
}